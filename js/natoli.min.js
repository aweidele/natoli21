!function(t,e){function i(e){var i=t(e?"#project-grid":"#project-list"),n=[];i.find(".next-link").each(function(){n.push(t(this).data("project-id"))}),t.cookie("next_project_order",n.join(),{path:"/"})}function n(e,i){var n=[],o=t("#project-list tbody");o.children().each(function(){n.push(t(this))}),n.sort(i?function(t,i){return i.attr("data-sort-"+e).localeCompare(t.attr("data-sort-"+e))}:function(t,i){return t.attr("data-sort-"+e).localeCompare(i.attr("data-sort-"+e))}),t.each(n,function(t,e){e.appendTo(o)})}function o(e){e.preventDefault();var o=t(this),r=o.data("sort-by"),a=o.hasClass("descending");n(r,a),t("#project-list th a").removeClass("selected descending"),o.addClass("selected"),a||o.addClass("descending"),t.cookie("project-sort",r,{path:"/"}),t.cookie("project-sort-direction",a?"":"descending",{path:"/"}),i(!1)}function r(t,e,i){var n=t.closest(e);t.css("width",n.width()),t.css("height",i*n.width())}var a=t("html").is(".ie6, .ie7, .ie8");e.scrollTop=function(){t("html,body").animate({scrollTop:0},500)},t.fn.natoliSlideSize=function(){function e(){i.css({height:o.height()-n.outerHeight()-30})}var i=t(this),n=t("#header"),o=(t("#menu-mobile-footer"),t("html"));t(window).resize(e),t(window).load(e),e()},t.fn.natoliImageConstrain=function(){function e(){i.each(function(){var e=t(this),i=e.parent(),n=e.data("focalx"),o=e.data("focaly"),r=i.outerWidth()||i.parent().outerWidth(),a=i.outerHeight()||i.parent().outerHeight(),s=e.data("ratio"),l=s*r,c=r;a>l&&(l=a,c=a/s),e.css({height:l,width:c}),"left"==n?e.css("left",0):"right"==n?e.css("left",r-c):e.css("left",(r-c)/2),"top"==o?e.css("top",0):"bottom"==o?e.css("top",a-l):e.css("top",(a-l)/2)})}var i=t(this);t(window).resize(e),e()},t.fn.natoliNewsChange=function(e){var i=this,n=t(e),o=0,a=i.filter(".selected");i.each(function(){var e=t(this);e.attr("id")||(o++,e.attr("id","ajax_id_"+o))});var s=window.History;return s.enabled?(s.Adapter.bind(window,"statechange",function(){var e=s.getState();"undefined"==typeof e.data.linkId&&(e.data.linkId=a.attr("id"));var o=t("#"+e.data.linkId),l=n.children();i.filter(".selected").removeClass("selected"),o.addClass("selected"),n.css("height",l.outerHeight()),l.css("position","absolute"),l.fadeOut(500,function(){l.remove()});var c;c=o.length?o.parent().parent().find(".news-content").html():t(".original .news-content").html(),n.append("<div class='ajax-content'>"+c+"</div>"),n.css("height","auto");var d=n.children(":last-child");d.fadeIn(500);var h=n.find("iframe");h.length&&r(h,".ajax-content",h.attr("height")/h.attr("width"))}),i.click(function(e){e.preventDefault();var i=t(this);i.hasClass("selected")||s.pushState({linkId:i.attr("id")},i.data("title"),i.attr("href"))}),this):void 0};var s=!1;t.fn.natoliProjectMobileWatch=function(e){function i(){if(r||o.is(":visible"))r&&o.is(":visible")&&(t("#project-grid").masonry({itemSelector:".grid-project",columnWidth:document.querySelector(".grid-project")}),r=!1,t("#project-grid").show(),t("#project-filters .inner-filters").show(),a=!1);else{if(null!=e)return void(document.location.href=e);s&&t("#project-grid").masonry("destroy"),s=!0,r=!0,t("#project-filters .inner-filters").hide()}}function n(){a?(t("#project-grid").slideDown(),t("#project-filters .inner-filters").slideUp(),a=!1):(t("html, body").animate({scrollTop:0}),t("#project-grid").slideUp(),t("#project-filters .inner-filters").slideDown(),a=!0)}var o=this,r=!1;i(),t(window).resize(i);var a=!1;t(".mobile-filters").click(n)};var l=[];t.fn.natoliSlideShow=function(e){var i={log:!1,swipe:!0};return t.extend(e,i),this.cycle(e)},t.fn.natoliProjectSlideShow=function(){var e={pager:"#pager",pagerTemplate:"",autoHeight:"container",paused:!0},i=this.width(),n=this.children("img");return n.each(function(){var e=t(this),n=e.data("ratio");e.css("height",n*i)}),t(window).load(function(){n.css("height","auto")}),this.natoliSlideShow(e)},t.fn.iframeWatch=function(e){function i(){r(n,e,o/a)}var n=this,o=n.outerHeight(),a=n.outerWidth();return t(window).resize(i),t(window).load(i),i(),this},t.fn.natoliMap=function(t,e){var i=this[0];google.maps.visualRefresh=!0;{var n=new google.maps.LatLng(t,e),o={zoom:15,center:n,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.SATELLITE]},mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},r=new google.maps.Map(i,o);new google.maps.Marker({position:n,map:r})}return this},t.fn.natoliGroupMenu=function(e){function i(){a.last().css("min-height",t(window).height()-n-t(".footer").outerHeight()-parseInt(r.css("margin-bottom")))}var n=t(".pre-header:visible").outerHeight()+t(".header").outerHeight()+parseInt(t(".fixed-header").css("top")),o=this,r=t("#main_content"),a=t(".grouped-page");if(i(),t(window).resize(i),null!=e){var s=t("#"+e).offset().top-n;window.scrollTo(0,s)}return o.find("a").each(function(){var e=null,i=t(this);if(a.each(function(){var n=t(this);return n.data("url")==i.attr("href")?(e=n.attr("id"),!1):void 0}),null!=e){var o=t("#"+e);i.click(function(e){e.preventDefault();var i=o.offset().top-n+1;t("html,body").stop().animate({scrollTop:i},1e3)}),l.push({menu:i,target:o})}}),t(window).scroll(function(){for(var e=t(window).scrollTop()+n,i=l[0].menu,r=1;r<l.length;r++){var a=l[r];if(a.target.offset().top>e)break;i=a.menu}if(!i.hasClass("current-menu-item")){var s=o.find(".current-menu-item");s.removeClass("current-menu-item"),i.parent().addClass("current-menu-item"),window.History.replaceState(null,t("title").text(),i.attr("href"))}}),this},t(function(){function e(){var e=t(".footer").outerHeight(),i=h.height(),n=t(".pre-header:visible").outerHeight()+t(".header").outerHeight()+parseInt(t(".fixed-header:visible").css("top"));c.css("min-height",i-n-e-parseInt(c.css("margin-bottom"))),d.each(function(){d.css("height",i-(t(this).offset().top-h.scrollTop())-e)})}function r(){var e=h.height(),i=t(".pre-header:visible").outerHeight()+t(".header").outerHeight()+parseInt(t(".fixed-header:visible").css("top"));t(".slide-wrap").css("height",e-i-t(".footer").outerHeight())}var l=document.getElementById("viewport");screen.width<=767&&(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?l.setAttribute("content","width=380,user-scalable=0"):l.setAttribute("content","width=380,minimum-scale=1,maximum-scale=1,user-scalable=0"));var c=t("#main_content"),d=t(".side-fixed, .landscape-side-fixed"),h=t(window);if(a?(setTimeout(e,100),setTimeout(e,1e3),setTimeout(e,5e3)):e(),h.resize(e),t("body.home").length&&(r(),h.resize(r)),t("#news_list").css("width",t("#news_filters").width()),t("#news_list ul li:last-child").addClass("last-child"),t("#project_index").length){var u=t("#project-grid");if(u.length)s||a||(u.masonry({itemSelector:".grid-project",columnWidth:document.querySelector(".grid-project")}),s=!0),t(".overlay").hover(function(){{var e=t(this);e.prev()}e.animate({opacity:1})},function(){t(this).animate({opacity:0})}),i(!0);else{t("#project-list th a").click(o);var p=t("#project-list th a.selected");n(p.data("sort-by"),!p.hasClass("descending"))}}else t("body.single-project").length&&(t("#pager img:nth-child(7n+0)").addClass("n7"),t("#pager img:nth-child(7n+1)").addClass("n7p1"))}),t(window).load(function(){function e(){i.css("width",t("#news_filters").width())}var i=t("#news_list");if(i.length){{t("#news_filters")}t(window).resize(e),e()}})}(jQuery,window.natoli=window.natoli||{});